시간상 모든 것을 정리하지 못하고 새롭게 알게된 것이나 의문점에 대해서만 기록하려고 한다.

## 임시 변수를 제거하고 질의 함수로 바꾸기

### 임시 변수
우선 임시변수가 무엇인지부터 정의하고 가자.
다른 변수로부터 계산되는 변수를 임시 변수라고 한다.

변수를 선언함으로써 생기는 단점은 다음과 같다.
- 변수를 사용하는 경우, 해당 변수의 유효 범위를 신경써야한다.
- 따라서 변수가 많아지는 경우 함수 추출이 어렵다.

### 질의 메서드(~for)와 result
질의 메서드는 그 이름 자체로 해당 변수를 나타내는 게 한눈에 보인다.
그렇기 때문에 그 안에서는 반환하는 값을 꼭 해당 값을 나타내는 이름이 아니라, result로 통합할 수 있다.
result라는 이름은 어떤 질의 메서드에서도 동일하게 사용 가능하며, 한눈에 반환하는 값이 무엇인지 알기 쉽게끔 한다.

### 리팩토링 vs 성능
하지만 변수를 선언하는 것은 여러번 계산되는 것을 한 번만 계산하는 효과를 가져온다.
리팩토링 책에서 제안하는대로 해당 변수가 사용되는 모든 곳을 메서드 호출 형태로 바꾼다면 같은 계산을 몇번이고 중복하여 수행하게 된다.
즉, 불필요한 연산이 추가된다.
리팩토링 관점에서 이 부분은 고려되지 않는 것일까?

우선 책을 따라가보자.

### Plays.getPerfromance(performance) vs playFor(Plays plays, Performance performance)
책에서는 질의 메서드를 생성하는 것을 권장한다.
따라서 playFor 메서드에서 Plays.getPerfromance(performance) 메서드를 호출하고 있다.
하지만 단순히 임시 변수를 제거한다는 관점에서는 Plays.getPerformance(performance) 만으로도 충분하다.

### 질의 메서드로 결과를 대체할 수 있는 경우
마찬가지로 변수로 저장하지 않는다.
총 2번이 사용되는데, 이때마다 메서드를 호출한다.
이름만으로 설명이 되기 때문에 변수 대신에 사용하는 것까지는 이해가 되지만,
여전히 불필요한 연산을 추가하는 것 같은 찜찜함은 존재한다.

# 반복문 쪼개기
하나의 반복문에 여러 임시 변수를 계산하는 로직이 있다면 반복문 쪼개기를 권장한다고 한다.
다시 복습하자면 임시 변수는 계산으로 얻을 수 있는 값을 저장한 변수이다.
이를 사용하면 메서드에서 수행하는 '로직'만을 중심으로 볼 수는 있을 듯 하다.

하지만 변수를 사용하지 않고 중복하여 호출하는 것만으로도 거부감을 느끼는 내게,
반복문을 반복해서 수행하라니... 코드로 옮길 생각도 못하고 그저 뭐?! 라는 생각에 쭉 책만 봤다.

## refactoring
리팩토링에서는 '가독성'을 중요시여긴다는 생각이 든다.
모든 전제는 '복잡성이 높은 프로젝트에서, 추후에 계속 수정될 가능성이 있고, 내가 아닌 다른 개발자가 수정할 가능성이 있는 코드'이다.
그렇기 때문에 추구하는 것이 
1. 가독성: 코드를 '분석'하지 않고 그 자체로 '이해'가 되는 것
2. 유지보수: 코드를 수정한다면 그 부분만 수정되도록 하는 것
이다.

이를 위해 최적화는 어느 정도 포기하는 것일까?

### 성능 문제는 특별한 경우가 아니라면 무시하라
궁금해하던 부분에 대한 설명이 나왔다.
아예 대놓고 리팩토링이 성능에 상당히 영향을 주더라도 특별한 경우가 아니면 무시하라고 한다.
잘 다듬어진 코드여야 성능의 개선 작업도 수월하고,
그렇기 때문에 리팩토링을 마무리하고 성능을 올리면 된다고 한다.
또한 웬만한 경우 (변수 대신 메서드 호출, 반복문 반복 실행) 등은 똑똑한 컴파일러의 최신 캐싱 기법 등으로 최적화가 되어 실질적의 성능 차이는 없다고 한다.

C를 사용하고, 최대한 중복 호출을 줄이고 줄이려던 내게는 굉장히 새로운 시각이다.
다만 서비스상에 있어서 아주 미세한 차이까지 극도로 최적화를 해야하는 경우는 많지 않으니,
결국에는 우선순위가 가독성과 유지보수 측면이 높을 수밖에 없다는 것에는 동의가 된다.

### ps. commit
리팩토링 중간에 테스트가 실패하는 경우 가장 최근 커밋으로 돌아가 단계를 더 작게 나누어 시도하라고 한다.
그러니 커밋을 잘게 쪼개라고.
커밋을 남기는 것에 대한 이정표도 얻어가는 것 같아 이부분은 꽤나 만족스럽다.

그리고, PR을 하나의 커밋 묶음이라며 3개의 커밋으로 충분하다는 말이 너무 충격이었는데,
오히려 PR에 대한 선입견이 부서져서 좋다.
말 그래도 하나로 정의할 수 있는 단위면 가능한 것이 아닐까.
추후에 유지보수할 때는 이런 방식으로 해야하겠다.

### 중간 점검
실제로 뺄 수 있는 모든 임시변수를 분리하고 나니까 로직이 한눈에 보인다.
수행하는 기능별로 한 줄에 모든 것이 설명되는 느낌이랄까.
난무하는 중첩함수라는 소제목에, 드디어 이부분을 개선하는 건가 설렌다.
가독성은 챙겼고, 유지보수도 쉬워진 것 같다.

